# 釣果記録アプリ 要件定義書

## 概要

釣った魚を記録・振り返るための個人用アプリ。MVPの目的は「釣果を簡単に記録できること」。趣味で釣りをする個人ユーザーが、釣果を手軽に記録し、後から振り返ることができるシステムを提供する。

## ユーザストーリー

### ストーリー1: 釣果記録

- **である** 個人の趣味の釣り人 **として**
- **私は** 釣った魚の情報を簡単に記録 **をしたい**
- **そうすることで** 釣果を後から振り返ることができる

### ストーリー2: 釣果一覧確認

- **である** 個人の趣味の釣り人 **として**
- **私は** 過去の釣果を一覧で確認 **をしたい**
- **そうすることで** 釣りの成果や傾向を把握できる

### ストーリー3: 釣果詳細確認

- **である** 個人の趣味の釣り人 **として**
- **私は** 特定の釣果の詳細情報を確認 **をしたい**
- **そうすることで** その時の釣りの状況や思い出を振り返ることができる

### ストーリー4: 記録の並び替え

- **である** 個人の趣味の釣り人 **として**
- **私は** 釣果記録を日付順で並び替え **をしたい**
- **そうすることで** 時系列で釣りの成果を確認できる

### ストーリー5: 写真からの自動データ取得

- **である** 個人の趣味の釣り人 **として**
- **私は** 写真をアップロードするだけで釣り場所と時間を自動入力 **をしたい**
- **そうすることで** 記録作成の手間を大幅に削減できる

### ストーリー6: 天気情報の自動取得

- **である** 個人の趣味の釣り人 **として**
- **私は** 釣行時の天気情報を自動で記録 **をしたい**
- **そうすることで** 天気と釣果の関係を後から分析できる

### ストーリー7: 潮汐情報の確認

- **である** 個人の趣味の釣り人 **として**
- **私は** 釣果記録に潮汐情報を自動表示 **をしたい**
- **そうすることで** 潮汐と釣果の関係を把握できる

### ストーリー8: 潮汐グラフの閲覧

- **である** 個人の趣味の釣り人 **として**
- **私は** その日の潮汐変化をグラフで確認 **をしたい**
- **そうすることで** 釣りのタイミングを視覚的に理解できる

## 機能要件（EARS記法）

### 通常要件

- REQ-001: システムは釣果記録を作成できなければならない
- REQ-002: システムは釣果記録を保存できなければならない
- REQ-003: システムは釣果記録を一覧表示できなければならない
- REQ-004: システムは釣果記録を詳細表示できなければならない
- REQ-005: システムは日付を記録できなければならない（デフォルトは当日）
- REQ-006: システムは場所を記録できなければならない
- REQ-007: システムは魚の種類を記録できなければならない
- REQ-008: システムは写真のEXIFデータから位置情報を抽出できなければならない
- REQ-009: システムは写真のEXIFデータから撮影日時を抽出できなければならない
- REQ-010: システムは位置情報と日時から天気情報を取得できなければならない
- REQ-011: システムは位置情報と日時から潮汐情報を計算できなければならない
- REQ-012: システムは潮汐グラフを表示できなければならない
- REQ-013: システムは釣果記録に潮汐コンテキストを保存できなければならない
- REQ-014: システムは天体計算による高精度な潮汐予測を提供できなければならない

### 条件付き要件

- REQ-101: ユーザーが日付順並び替えを選択した場合、システムは記録を日付順で表示しなければならない
- REQ-102: ユーザーがGPS取得を許可した場合、システムは現在位置を場所として取得してもよい
- REQ-103: ユーザーが写真を添付する場合、システムは1枚の写真を保存できなければならない
- REQ-104: ユーザーが写真メタデータの自動取得を許可した場合、システムはEXIFデータを読み取らなければならない
- REQ-105: ユーザーが天気情報の自動取得を許可した場合、システムは外部天気APIを呼び出さなければならない
- REQ-106: 写真にGPS情報が含まれる場合、システムは逆ジオコーディングで住所を取得しなければならない
- REQ-107: GPS座標が取得できた場合、システムは潮汐情報を自動計算しなければならない
- REQ-108: ユーザーが潮汐グラフ表示を選択した場合、システムは24時間の潮位変化グラフを表示しなければならない
- REQ-109: 釣果記録に位置情報が含まれる場合、システムは潮汐コンテキストを自動付与しなければならない

### 状態要件

- REQ-201: 記録が存在しない場合、システムは空の状態を表示しなければならない
- REQ-202: 詳細表示において写真が存在する場合、システムは写真を表示しなければならない
- REQ-203: 詳細表示において潮汐情報が存在する場合、システムは潮汐データを表示しなければならない
- REQ-204: 潮汐計算が進行中の場合、システムはローディング状態を表示しなければならない

### オプション要件

- REQ-301: システムはGPSから位置情報を取得してもよい
- REQ-302: システムは写真を添付できてもよい
- REQ-303: システムはサイズを数値で記録できてもよい
- REQ-304: システムは天気情報（気温、湿度、風速、気圧）を記録できてもよい
- REQ-305: システムは写真撮影時のカメラ情報を記録できてもよい
- REQ-306: システムは自動取得されたデータに対して手動修正を許可してもよい
- REQ-307: システムは潮汐グラフにインタラクティブ機能を提供してもよい（ズーム、パン等）
- REQ-308: システムは潮汐強度や潮汐タイプの詳細分析を表示してもよい
- REQ-309: システムは潮汐データをキャッシュして高速表示してもよい

### 制約要件

- REQ-401: システムは写真を1枚までしか添付できない制約を持たなければならない
- REQ-402: システムは入力されたデータを永続化しなければならない
- REQ-403: システムは天気API呼び出し回数を制限しなければならない（無料枠考慮）
- REQ-404: システムはEXIFデータをメモリ内でのみ処理し、サーバーに送信してはならない
- REQ-405: システムは位置情報の利用について明示的にユーザー同意を得なければならない
- REQ-406: システムは潮汐計算をオフラインで実行し、外部APIに依存してはならない
- REQ-407: システムは潮汐計算の精度を±30分以内に保持しなければならない
- REQ-408: システムは潮汐計算の応答時間を200ms以内に制限しなければならない
- REQ-409: システムは潮汐キャッシュサイズを適切に管理しなければならない（メモリ制約考慮）

## 非機能要件

### パフォーマンス

- NFR-001: システムはスマホアプリ（またはWebアプリ）として適切な応答速度を提供しなければならない
- NFR-002: システムは画像表示を最適化しなければならない
- NFR-003: システムは一覧表示を適切な速度で読み込みしなければならない

### ユーザビリティ

- NFR-101: システムは直感的な操作性を提供しなければならない
- NFR-102: システムはシンプルで分かりやすいUIを提供しなければならない
- NFR-103: システムはMVP目的である「簡単に記録できること」を実現しなければならない

### データ管理

- NFR-201: システムはローカルストレージでデータを永続化しなければならない
- NFR-202: システムはデータの整合性を保持しなければならない

### プラットフォーム

- NFR-301: システムはスマホ（iOS/Android）に対応しなければならない
- NFR-302: システムはMVPとしてWebアプリでも動作してもよい

## Edgeケース

### エラー処理

- EDGE-001: GPS取得が失敗した場合、システムは手動入力にフォールバックしなければならない
- EDGE-002: 写真読み込みが失敗した場合、システムは適切なエラーメッセージを表示しなければならない
- EDGE-003: データ保存が失敗した場合、システムはユーザーに警告を表示しなければならない
- EDGE-004: ネットワーク接続がない場合、システムはオフラインで動作しなければならない
- EDGE-005: EXIFデータが存在しない写真の場合、システムは手動入力にフォールバックしなければならない
- EDGE-006: 天気API呼び出しが失敗した場合、システムは天気情報なしで記録を保存しなければならない
- EDGE-007: GPS精度が低い場合、システムはユーザーに精度情報を表示しなければならない
- EDGE-008: 潮汐計算が失敗した場合、システムは潮汐情報なしで記録を保存しなければならない
- EDGE-009: 地域補正データが存在しない場合、システムは理論値で潮汐計算を実行しなければならない
- EDGE-010: メモリ不足で潮汐キャッシュが満杯の場合、システムはLRU方式で古いデータを削除しなければならない

### 境界値

- EDGE-101: 場所・魚種の入力は文字数制限（例：100文字）を設けなければならない
- EDGE-102: 画像ファイルはサイズ制限（例：5MB）を設けなければならない
- EDGE-103: サイズ入力は適切な数値範囲（例：0-999cm）を設定しなければならない
- EDGE-104: 記録件数が大量になった場合もパフォーマンスを維持しなければならない
- EDGE-105: 潮汐グラフ描画時のSVG要素数が多い場合もパフォーマンスを維持しなければならない
- EDGE-106: 潮汐計算で異常な座標値（海以外）が入力された場合は適切にエラー処理しなければならない

### データ状態

- EDGE-201: 初回起動時（記録が0件）は適切なガイダンスを表示しなければならない
- EDGE-202: 不正なデータ形式での入力は適切にバリデーションしなければならない
- EDGE-203: データが破損した場合は適切に処理しなければならない

### ユーザー操作

- EDGE-301: 画面回転時は入力状態を保持しなければならない
- EDGE-302: アプリのバックグラウンド・フォアグラウンド切り替え時は状態を保持しなければならない
- EDGE-303: 長時間操作がない場合も適切に動作しなければならない

## 受け入れ基準

### 機能テスト

- [x] 釣果記録を作成できる
- [x] 日付、場所、魚種、サイズ、写真を入力できる
- [x] 記録を保存できる
- [x] 記録を一覧表示できる
- [x] 記録の詳細を表示できる
- [x] 日付順での並び替えができる
- [x] GPS位置情報を取得できる（オプション）
- [x] 写真を1枚まで添付できる
- [x] 空の状態を適切に表示できる

### 非機能テスト

- [x] スマホで適切に動作する
- [x] 画像表示が適切に最適化されている
- [x] 一覧表示の読み込み速度が適切である
- [x] 直感的で分かりやすいUIになっている
- [x] データがローカルに永続化される
- [x] データの整合性が保たれる

### Edgeケーステスト

- [x] GPS取得失敗時のフォールバック処理が動作する
- [x] 写真読み込み失敗時のエラー表示が適切である
- [x] データ保存失敗時の警告表示が動作する
- [x] オフライン環境でも動作する
- [x] 文字数制限が適切に機能する
- [x] 画像サイズ制限が適切に機能する
- [x] 数値範囲のバリデーションが動作する
- [x] 大量データでもパフォーマンスが維持される
- [x] 初回起動時のガイダンスが表示される
- [x] 不正データのバリデーションが動作する
- [x] 画面回転時の状態保持が動作する

### 潮汐システムテスト（追加）

- [ ] 位置情報から潮汐情報を計算できる
- [ ] 潮汐グラフを正しく表示できる
- [ ] 釣果記録に潮汐コンテキストが保存される
- [ ] 天体計算による高精度潮汐予測が動作する
- [ ] GPS座標取得時の潮汐自動計算が動作する
- [ ] 24時間潮位変化グラフが表示される
- [ ] 潮汐情報の詳細表示が動作する
- [ ] 潮汐計算進行中のローディング表示が動作する
- [ ] 潮汐計算失敗時のフォールバック処理が動作する
- [ ] 地域補正データなし時の理論値計算が動作する
- [ ] 潮汐キャッシュのLRU削除が動作する
- [ ] オフライン潮汐計算が動作する
- [ ] 潮汐計算精度が±30分以内である
- [ ] 潮汐計算応答時間が200ms以内である
- [ ] 潮汐グラフのパフォーマンスが適切である
- [ ] 異常座標での潮汐計算エラー処理が動作する