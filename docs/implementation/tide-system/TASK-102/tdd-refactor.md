# TASK-102: 調和解析エンジン - Refactor Phase（品質向上）

## 目的
Green Phaseで動作確認できた実装に対して、コードの品質向上と計算精度の改善を行う。
テストが通ることを保ちながら、保守性・パフォーマンス・精度を向上させる。

## リファクタリング目標

### 1. 計算精度の向上
- 極値検出精度: ±4時間 → ±10分
- 潮位計算精度: ±5cm → ±1cm
- 分潮係数計算: 簡略版 → 高精度版

### 2. コード構造の改善
- 極値検出アルゴリズムの最適化
- 分潮係数計算の高精度化
- エラーハンドリングの強化

### 3. パフォーマンス最適化
- 計算効率の向上
- メモリ使用量の最適化

## 実装改善

### 1. 分潮係数計算の高精度化

現在の簡略計算を、より詳細な天文計算に置き換え：
- 月の昇交点経度の高精度計算
- 太陽の平均近点角の考慮
- 月の近地点引数の考慮

### 2. 極値検出アルゴリズムの改善

数値微分による基本検出を、より高精度なアルゴリズムに改善：
- 3点法による数値微分の精度向上
- 極値候補の詳細検証
- 偽極値の除去アルゴリズム

### 3. 潮位計算精度の向上

基本的な調和解析計算を高精度化：
- 時刻基準の統一
- 位相計算の精度向上
- 数値計算の最適化

## 改善実装内容

以下の順序でリファクタリングを実施し、各段階でテストの通過を確認する。

### Step 1: 分潮係数計算の高精度化
### Step 2: 極値検出アルゴリズムの改善
### Step 3: 潮位計算精度の向上
### Step 4: パフォーマンス最適化
### Step 5: コード品質向上