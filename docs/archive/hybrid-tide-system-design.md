# ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ½®æ±ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸

## ğŸ“‹ ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

**å®Œå…¨ç„¡æ–™ãƒ»ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ»ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ**ã®æ½®æ±æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ ã€‚å¤©ä½“è¨ˆç®—ã¨åœ°åŸŸè£œæ­£ãƒ‡ãƒ¼ã‚¿ã‚’çµ„ã¿åˆã‚ã›ãŸãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ–¹å¼ã«ã‚ˆã‚Šã€APIã«ä¾å­˜ã›ãšã«å®Ÿç”¨ãƒ¬ãƒ™ãƒ«ã®æ½®æ±æƒ…å ±ã‚’æä¾›ã—ã¾ã™ã€‚

### ã‚³ã‚¢è¨­è¨ˆæ€æƒ³
- **Zero API Dependency**: å¤–éƒ¨APIä¸€åˆ‡ä¸ä½¿ç”¨
- **Real-time Calculation**: ç¬æ™‚è¨ˆç®—ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¿œç­”
- **Offline First**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸è¦ã§å®Œå…¨å‹•ä½œ
- **Practical Accuracy**: é‡£ã‚Šç”¨é€”ã«ååˆ†ãªç²¾åº¦ï¼ˆÂ±30åˆ†ï¼‰

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 3å±¤æ§‹é€ è¨­è¨ˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   UI Layer                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ æ½®æ±è¡¨ç¤º     â”‚  â”‚ é‡£æœè¨˜éŒ²     â”‚  â”‚ æ½®æ±ãƒãƒ£ãƒ¼ãƒˆ â”‚      â”‚
â”‚  â”‚ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆâ”‚  â”‚ çµ±åˆ         â”‚  â”‚ å¯è¦–åŒ–       â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Business Logic Layer                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ æ½®æ±äºˆæ¸¬     â”‚  â”‚ æ½®æ±ã‚¿ã‚¤ãƒ—   â”‚  â”‚ æ™‚é–“é–¢ä¿‚     â”‚      â”‚
â”‚  â”‚ ã‚¨ãƒ³ã‚¸ãƒ³     â”‚  â”‚ åˆ¤å®š         â”‚  â”‚ è¨ˆç®—         â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Calculation Engine Layer                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ å¤©ä½“è¨ˆç®—     â”‚  â”‚ èª¿å’Œè§£æ     â”‚  â”‚ åœ°åŸŸè£œæ­£     â”‚      â”‚
â”‚  â”‚ ã‚¨ãƒ³ã‚¸ãƒ³     â”‚  â”‚ ã‚¨ãƒ³ã‚¸ãƒ³     â”‚  â”‚ ãƒ‡ãƒ¼ã‚¿       â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§® è¨ˆç®—ã‚¨ãƒ³ã‚¸ãƒ³è¨­è¨ˆ

### 1. å¤©ä½“è¨ˆç®—ã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆAstronomicalCalculatorï¼‰

#### æœˆé½¢è¨ˆç®—
```typescript
class MoonPhaseCalculator {
  /**
   * æŒ‡å®šæ—¥æ™‚ã®æœˆé½¢ã‚’è¨ˆç®—
   * @param date å¯¾è±¡æ—¥æ™‚
   * @returns æœˆé½¢ï¼ˆ0-29.53æ—¥ï¼‰
   */
  calculateMoonAge(date: Date): number {
    // ãƒ‹ãƒ¥ãƒ¼ã‚«ãƒ ï¼ˆNewcombï¼‰ã®å…¬å¼ã«ã‚ˆã‚‹é«˜ç²¾åº¦æœˆé½¢è¨ˆç®—
    const baseNewMoon = new Date('2000-01-06T18:14:00Z'); // J2000.0åŸºæº–æ–°æœˆ
    const synodicMonth = 29.530588853; // æœ”æœ›æœˆï¼ˆæ—¥ï¼‰

    const diffDays = (date.getTime() - baseNewMoon.getTime()) / (1000 * 60 * 60 * 24);
    return ((diffDays % synodicMonth) + synodicMonth) % synodicMonth;
  }

  /**
   * æœˆç›¸ã‚’åˆ¤å®š
   */
  getMoonPhase(moonAge: number): MoonPhase {
    if (moonAge < 1.84566 || moonAge > 27.68457) return 'æ–°æœˆ';
    if (moonAge >= 5.53699 && moonAge < 9.22262) return 'ä¸Šå¼¦';
    if (moonAge >= 12.91825 && moonAge < 16.61388) return 'æº€æœˆ';
    if (moonAge >= 20.29951 && moonAge < 24.99514) return 'ä¸‹å¼¦';
    return moonAge < 14.765294 ? 'ä¸Šå¼¦å¯„ã‚Š' : 'ä¸‹å¼¦å¯„ã‚Š';
  }
}
```

#### å¤ªé™½ãƒ»æœˆã®ä½ç½®è¨ˆç®—
```typescript
class CelestialPositionCalculator {
  /**
   * å¤ªé™½ã®åœ°å¿ƒçµŒåº¦ã‚’è¨ˆç®—ï¼ˆVSOP87ç†è«–ï¼‰
   */
  calculateSolarLongitude(jd: number): number {
    // ç°¡æ˜“VSOP87å®Ÿè£…
    const T = (jd - 2451545.0) / 36525; // ãƒ¦ãƒªã‚¦ã‚¹ä¸–ç´€

    // å¤ªé™½ã®å¹³å‡çµŒåº¦
    const L0 = 280.46646 + 36000.76983 * T + 0.0003032 * T * T;

    // è¿‘ç‚¹é›¢è§’
    const M = 357.52911 + 35999.05029 * T - 0.0001537 * T * T;

    // ä¸­å¿ƒå·®
    const C = (1.914602 - 0.004817 * T - 0.000014 * T * T) * Math.sin(this.degToRad(M))
            + (0.019993 - 0.000101 * T) * Math.sin(this.degToRad(2 * M))
            + 0.000289 * Math.sin(this.degToRad(3 * M));

    return this.normalizeAngle(L0 + C);
  }

  /**
   * æœˆã®åœ°å¿ƒçµŒåº¦ã‚’è¨ˆç®—ï¼ˆELP2000ç†è«–ç°¡æ˜“ç‰ˆï¼‰
   */
  calculateLunarLongitude(jd: number): number {
    const T = (jd - 2451545.0) / 36525;

    // æœˆã®å¹³å‡çµŒåº¦
    const L = 218.3164477 + 481267.88123421 * T - 0.0015786 * T * T;

    // ä¸»è¦ãªæ‘‚å‹•é …
    const D = 297.8501921 + 445267.1114034 * T; // æœˆã®å¹³å‡é›¢è§’
    const M = 357.5291092 + 35999.0502909 * T;  // å¤ªé™½ã®å¹³å‡è¿‘ç‚¹è§’
    const Mp = 134.9633964 + 477198.8675055 * T; // æœˆã®å¹³å‡è¿‘ç‚¹è§’

    // ä¸»è¦æ‘‚å‹•é …ã«ã‚ˆã‚‹è£œæ­£
    const perturbation =
      6.288774 * Math.sin(this.degToRad(Mp)) +
      1.274027 * Math.sin(this.degToRad(2 * D - Mp)) +
      0.658314 * Math.sin(this.degToRad(2 * D));

    return this.normalizeAngle(L + perturbation);
  }
}
```

### 2. èª¿å’Œè§£æã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆHarmonicAnalysisï¼‰

#### ä¸»è¦æ½®æ±æˆåˆ†
```typescript
interface TidalConstituent {
  name: string;           // åˆ†æ½®å
  frequency: number;      // è§’å‘¨æ³¢æ•°ï¼ˆåº¦/æ™‚ï¼‰
  amplitude: number;      // æŒ¯å¹…ï¼ˆåŸºæº–å€¤ï¼‰
  phase: number;         // ä½ç›¸ï¼ˆåº¦ï¼‰
  description: string;    // èª¬æ˜
}

const MAJOR_CONSTITUENTS: TidalConstituent[] = [
  // ä¸»å¤ªé™°åŠæ—¥å‘¨æ½®ï¼ˆæœ€ã‚‚é‡è¦ï¼‰
  { name: 'M2', frequency: 28.9841042, amplitude: 1.0, phase: 0, description: 'ä¸»å¤ªé™°åŠæ—¥å‘¨æ½®' },

  // ä¸»å¤ªé™½åŠæ—¥å‘¨æ½®
  { name: 'S2', frequency: 30.0, amplitude: 0.465, phase: 0, description: 'ä¸»å¤ªé™½åŠæ—¥å‘¨æ½®' },

  // å¤ªé™°æ—¥å‘¨æ½®
  { name: 'K1', frequency: 15.0410686, amplitude: 0.584, phase: 0, description: 'å¤ªé™°æ—¥å‘¨æ½®' },
  { name: 'O1', frequency: 13.9430356, amplitude: 0.377, phase: 0, description: 'ä¸»å¤ªé™°æ—¥å‘¨æ½®' },

  // é•·å‘¨æœŸæ½®
  { name: 'Mf', frequency: 1.0980331, amplitude: 0.174, phase: 0, description: 'å¤ªé™°äºŒé€±é–“æ½®' },
  { name: 'Mm', frequency: 0.5443747, amplitude: 0.097, phase: 0, description: 'å¤ªé™°æœˆæ½®' },
];
```

#### æ½®æ±äºˆæ¸¬è¨ˆç®—
```typescript
class TidalPredictionEngine {
  /**
   * æŒ‡å®šæ™‚åˆ»ã®æ½®ä½ã‚’è¨ˆç®—
   */
  calculateTideLevel(
    dateTime: Date,
    location: Location,
    constituents: TidalConstituent[]
  ): number {
    const t = this.getHoursSinceEpoch(dateTime);
    let tideLevel = 0;

    for (const constituent of constituents) {
      // å„åˆ†æ½®æˆåˆ†ã®å¯„ä¸ã‚’è¨ˆç®—
      const argument = this.degToRad(constituent.frequency * t + constituent.phase);
      const regionalAmplitude = this.getRegionalAmplitude(constituent.name, location);

      tideLevel += regionalAmplitude * constituent.amplitude * Math.cos(argument);
    }

    return tideLevel;
  }

  /**
   * æº€æ½®ãƒ»å¹²æ½®æ™‚åˆ»ã‚’è¨ˆç®—
   */
  findTidalExtremes(date: Date, location: Location): TideEvent[] {
    const events: TideEvent[] = [];
    const startTime = new Date(date);
    startTime.setHours(0, 0, 0, 0);

    // 6åˆ†é–“éš”ã§24æ™‚é–“åˆ†ã‚’ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°
    const samples: { time: Date; level: number }[] = [];
    for (let minutes = 0; minutes < 24 * 60; minutes += 6) {
      const sampleTime = new Date(startTime.getTime() + minutes * 60 * 1000);
      const level = this.calculateTideLevel(sampleTime, location, MAJOR_CONSTITUENTS);
      samples.push({ time: sampleTime, level });
    }

    // æ¥µå€¤ã‚’æ¤œå‡º
    for (let i = 1; i < samples.length - 1; i++) {
      const prev = samples[i - 1];
      const current = samples[i];
      const next = samples[i + 1];

      // æ¥µå¤§å€¤ï¼ˆæº€æ½®ï¼‰
      if (current.level > prev.level && current.level > next.level) {
        events.push({
          type: 'high',
          time: current.time.toTimeString().slice(0, 5),
          height: current.level,
          timestamp: current.time.getTime()
        });
      }
      // æ¥µå°å€¤ï¼ˆå¹²æ½®ï¼‰
      else if (current.level < prev.level && current.level < next.level) {
        events.push({
          type: 'low',
          time: current.time.toTimeString().slice(0, 5),
          height: current.level,
          timestamp: current.time.getTime()
        });
      }
    }

    return events;
  }
}
```

### 3. åœ°åŸŸè£œæ­£ãƒ‡ãƒ¼ã‚¿ï¼ˆRegionalCorrectionsï¼‰

#### æ—¥æœ¬ä¸»è¦é‡£ã‚Šå ´ã®è£œæ­£ä¿‚æ•°
```typescript
interface RegionalTideData {
  id: string;
  name: string;
  location: { lat: number; lon: number };

  // M2åˆ†æ½®ã®åœ°åŸŸç‰¹æ€§
  m2Amplitude: number;    // M2æŒ¯å¹…æ¯”ï¼ˆåŸºæº–=1.0ï¼‰
  m2Phase: number;        // M2ä½ç›¸å·®ï¼ˆåº¦ï¼‰

  // S2åˆ†æ½®ã®åœ°åŸŸç‰¹æ€§
  s2Amplitude: number;
  s2Phase: number;

  // ãã®ä»–åˆ†æ½®ã®è£œæ­£
  diurnalRatio: number;   // æ—¥å‘¨æ½®/åŠæ—¥å‘¨æ½® æ¯”

  // åœ°å½¢çš„ç‰¹å¾´
  resonanceFactors: {
    shallow: number;      // æµ…æµ·åŠ¹æœ
    bay: number;          // æ¹¾ã®å…±é³´åŠ¹æœ
    strait: number;       // æµ·å³¡åŠ¹æœ
  };
}

const REGIONAL_TIDE_DATA: RegionalTideData[] = [
  {
    id: 'tokyo_bay',
    name: 'æ±äº¬æ¹¾',
    location: { lat: 35.6762, lon: 139.6503 },
    m2Amplitude: 1.45,    // æ±äº¬æ¹¾ã¯å…±é³´ã«ã‚ˆã‚ŠæŒ¯å¹…ãŒå¤§
    m2Phase: 25,          // ä½ç›¸é…ã‚Œ
    s2Amplitude: 1.20,
    s2Phase: 30,
    diurnalRatio: 0.25,   // åŠæ—¥å‘¨æ½®å“è¶Š
    resonanceFactors: {
      shallow: 1.2,       // æµ…æµ·åŠ¹æœã‚ã‚Š
      bay: 1.8,           // æ¹¾ã®å…±é³´å¤§
      strait: 1.0
    }
  },

  {
    id: 'osaka_bay',
    name: 'å¤§é˜ªæ¹¾',
    location: { lat: 34.6937, lon: 135.5023 },
    m2Amplitude: 1.15,
    m2Phase: 15,
    s2Amplitude: 1.05,
    s2Phase: 20,
    diurnalRatio: 0.30,
    resonanceFactors: {
      shallow: 1.1,
      bay: 1.4,
      strait: 1.0
    }
  },

  {
    id: 'suruga_bay',
    name: 'é§¿æ²³æ¹¾',
    location: { lat: 35.0158, lon: 138.5984 },
    m2Amplitude: 0.95,    // å¤–æ´‹ã«è¿‘ãæŒ¯å¹…å°
    m2Phase: 5,
    s2Amplitude: 0.90,
    s2Phase: 10,
    diurnalRatio: 0.35,
    resonanceFactors: {
      shallow: 0.9,
      bay: 1.1,
      strait: 1.0
    }
  },

  // ... ä¸»è¦é‡£ã‚Šå ´50ç®‡æ‰€ç¨‹åº¦ã‚’å®šç¾©
];
```

#### åœ°åŸŸè£œæ­£ãƒ­ã‚¸ãƒƒã‚¯
```typescript
class RegionalCorrectionEngine {
  /**
   * æœ€å¯„ã‚Šã®åœ°åŸŸãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢
   */
  findNearestRegion(location: Location): RegionalTideData {
    let nearest = REGIONAL_TIDE_DATA[0];
    let minDistance = this.calculateDistance(location, nearest.location);

    for (const region of REGIONAL_TIDE_DATA) {
      const distance = this.calculateDistance(location, region.location);
      if (distance < minDistance) {
        minDistance = distance;
        nearest = region;
      }
    }

    return nearest;
  }

  /**
   * åœ°åŸŸç‰¹æ€§ã‚’é©ç”¨ã—ãŸåˆ†æ½®ä¿‚æ•°ã‚’è¨ˆç®—
   */
  applyRegionalCorrection(
    constituent: TidalConstituent,
    regionalData: RegionalTideData
  ): TidalConstituent {
    const corrected = { ...constituent };

    switch (constituent.name) {
      case 'M2':
        corrected.amplitude *= regionalData.m2Amplitude;
        corrected.phase += regionalData.m2Phase;
        break;
      case 'S2':
        corrected.amplitude *= regionalData.s2Amplitude;
        corrected.phase += regionalData.s2Phase;
        break;
      case 'K1':
      case 'O1':
        corrected.amplitude *= regionalData.diurnalRatio;
        break;
    }

    // åœ°å½¢åŠ¹æœã‚’é©ç”¨
    corrected.amplitude *= this.calculateResonanceFactor(
      constituent,
      regionalData.resonanceFactors
    );

    return corrected;
  }

  /**
   * 2ç‚¹é–“ã®è·é›¢ã‚’è¨ˆç®—ï¼ˆãƒãƒãƒ¼ã‚µã‚¤ãƒ³å…¬å¼ï¼‰
   */
  private calculateDistance(
    point1: { lat: number; lon: number },
    point2: { lat: number; lon: number }
  ): number {
    const R = 6371; // åœ°çƒåŠå¾„ï¼ˆkmï¼‰
    const dLat = this.degToRad(point2.lat - point1.lat);
    const dLon = this.degToRad(point2.lon - point1.lon);

    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
              Math.cos(this.degToRad(point1.lat)) *
              Math.cos(this.degToRad(point2.lat)) *
              Math.sin(dLon / 2) * Math.sin(dLon / 2);

    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
  }
}
```

## ğŸ¯ æ½®æ±ã‚¿ã‚¤ãƒ—åˆ¤å®šã‚·ã‚¹ãƒ†ãƒ 

### å¤§æ½®ãƒ»å°æ½®åˆ¤å®šã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
```typescript
class TideTypeClassifier {
  /**
   * æœˆé½¢ã«åŸºã¥ãæ½®æ±ã‚¿ã‚¤ãƒ—åˆ¤å®š
   */
  classifyTideType(moonAge: number): TideType {
    // å¤§æ½®: æ–°æœˆãƒ»æº€æœˆã®å‰å¾Œ1.5æ—¥
    if (moonAge <= 1.5 || moonAge >= 28 ||
        (moonAge >= 13 && moonAge <= 16)) {
      return 'å¤§æ½®';
    }

    // å°æ½®: ä¸Šå¼¦ãƒ»ä¸‹å¼¦ã®å‰å¾Œ1.5æ—¥
    if ((moonAge >= 5.5 && moonAge <= 8.5) ||
        (moonAge >= 20.5 && moonAge <= 23.5)) {
      return 'å°æ½®';
    }

    // é•·æ½®: å°æ½®ã®ç¿Œæ—¥
    if (moonAge === 9 || moonAge === 24) {
      return 'é•·æ½®';
    }

    // è‹¥æ½®: é•·æ½®ã®ç¿Œæ—¥
    if (moonAge === 10 || moonAge === 25) {
      return 'è‹¥æ½®';
    }

    // ãã®ä»–ã¯ä¸­æ½®
    return 'ä¸­æ½®';
  }

  /**
   * æ½®æ±å¼·åº¦ã‚’è¨ˆç®—ï¼ˆ0-100ï¼‰
   */
  calculateTideStrength(
    moonAge: number,
    sunMoonAngle: number
  ): number {
    // æœˆã®åŠ¹æœï¼ˆæœ”æœ›æœˆã«ã‚ˆã‚‹ï¼‰
    const moonEffect = Math.cos(2 * Math.PI * moonAge / 29.53);

    // å¤ªé™½ã®åŠ¹æœï¼ˆå¤ªé™½ã¨æœˆã®è§’åº¦ã«ã‚ˆã‚‹ï¼‰
    const sunEffect = Math.cos(sunMoonAngle);

    // åˆæˆåŠ¹æœï¼ˆ0-100%ï¼‰
    const combinedEffect = (moonEffect + 0.46 * sunEffect) / 1.46;
    return Math.max(0, Math.min(100, (combinedEffect + 1) * 50));
  }
}
```

## ğŸ“Š æœ€çµ‚ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### çµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
```typescript
interface HybridTideInfo {
  // åŸºæœ¬æƒ…å ±
  id: string;
  calculatedAt: string;
  location: Location;
  date: string;

  // å¤©ä½“æƒ…å ±
  astronomical: {
    moonAge: number;              // æœˆé½¢
    moonPhase: MoonPhase;         // æœˆç›¸
    sunMoonAngle: number;         // å¤ªé™½-æœˆè§’åº¦
  };

  // æ½®æ±åˆ†é¡
  classification: {
    tideType: TideType;           // å¤§æ½®ãƒ»å°æ½®ç­‰
    strength: number;             // æ½®æ±å¼·åº¦ï¼ˆ0-100ï¼‰
    perigeeApogee: 'perigee' | 'apogee' | 'normal'; // è¿‘åœ°ç‚¹ãƒ»é åœ°ç‚¹
  };

  // æ½®æ±ã‚¤ãƒ™ãƒ³ãƒˆ
  events: TideEvent[];

  // åœ°åŸŸæƒ…å ±
  regional: {
    nearestStation: string;       // æœ€å¯„ã‚Šè¦³æ¸¬ç‚¹
    distanceKm: number;          // è·é›¢
    correctionApplied: boolean;   // è£œæ­£é©ç”¨æ¸ˆã¿
  };

  // è¨ˆç®—ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  metadata: {
    algorithm: 'hybrid-astronomical-v1';
    constituents: string[];       // ä½¿ç”¨åˆ†æ½®
    accuracy: 'high' | 'medium' | 'low';
    confidence: number;           // ä¿¡é ¼åº¦ï¼ˆ0-100ï¼‰
  };
}

interface TideContext {
  // é‡£æœã¨ã®é–¢ä¿‚
  catchTime: string;
  tidePhase: 'rising' | 'falling' | 'high' | 'low' | 'slack';

  // æ¬¡ã®ã‚¤ãƒ™ãƒ³ãƒˆ
  nextEvent: {
    type: 'high' | 'low';
    time: string;
    timeUntil: string;
    heightDifference: number;     // ç¾åœ¨ã¨ã®æ½®ä½å·®
  };

  // æ½®æ±çŠ¶æ…‹
  currentState: {
    phase: string;                // 'ä¸Šã’æ½®ä¸­ç›¤'ç­‰
    velocity: number;             // æ½®æµé€Ÿåº¦æ¨å®š
    optimalFishing: boolean;      // é‡£ã‚Šã«é©ã—ãŸæ™‚é–“å¸¯ã‹
  };
}
```

## âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­è¨ˆ

### è¨ˆç®—æœ€é©åŒ–
```typescript
class TideCalculationOptimizer {
  private cache = new Map<string, HybridTideInfo>();

  /**
   * ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ç”Ÿæˆ
   */
  private generateCacheKey(location: Location, date: Date): string {
    const lat = Math.round(location.latitude * 100) / 100;
    const lon = Math.round(location.longitude * 100) / 100;
    const dateStr = date.toISOString().slice(0, 10);
    return `${lat},${lon},${dateStr}`;
  }

  /**
   * é«˜é€Ÿè¨ˆç®—ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ´»ç”¨ï¼‰
   */
  async calculateOptimized(
    location: Location,
    date: Date
  ): Promise<HybridTideInfo> {
    const cacheKey = this.generateCacheKey(location, date);

    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ
    if (this.cache.has(cacheKey)) {
      return this.cache.get(cacheKey)!;
    }

    // æ–°è¦è¨ˆç®—
    const result = await this.performCalculation(location, date);

    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¿å­˜ï¼ˆãƒ¡ãƒ¢ãƒªåˆ¶é™è€ƒæ…®ï¼‰
    if (this.cache.size > 100) {
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
    this.cache.set(cacheKey, result);

    return result;
  }
}
```

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ç›®æ¨™
- **åˆå›è¨ˆç®—**: 200msä»¥å†…
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ**: 10msä»¥å†…
- **ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰æ›´æ–°**: 1ç§’ä»¥å†…

## ğŸ¨ UIçµ±åˆè¨­è¨ˆ

### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
```typescript
const TideInfoDisplay: React.FC<{ location: Location; catchTime?: string }> = ({
  location,
  catchTime
}) => {
  const [tideInfo, setTideInfo] = useState<HybridTideInfo | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const calculator = new HybridTideCalculator();

    calculator.calculateOptimized(location, new Date())
      .then(setTideInfo)
      .finally(() => setLoading(false));
  }, [location]);

  if (loading) return <TideLoadingSpinner />;
  if (!tideInfo) return <TideErrorDisplay />;

  return (
    <div className="tide-info-panel">
      <TideTypeIndicator
        tideType={tideInfo.classification.tideType}
        strength={tideInfo.classification.strength}
      />

      <TideEventsChart
        events={tideInfo.events}
        currentTime={catchTime}
      />

      <TideContextDisplay
        context={calculateTideContext(tideInfo, catchTime)}
      />
    </div>
  );
};
```

ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šã€**å®Œå…¨ç„¡æ–™ãƒ»ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ»é«˜ç²¾åº¦**ãªæ½®æ±æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ ãŒå®Ÿç¾ã§ãã¾ã™ã€‚