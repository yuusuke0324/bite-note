# 設計書管理ガイドライン

**重要**: コード改修前に必ず設計書の更新要否を判断すること

---

## 設計書の定義

このプロジェクトにおける設計書とは、以下のドキュメント群を指します。

```
bite-note/
├── docs/design/                        # 設計ドキュメント
│   ├── architecture.md                 # アーキテクチャ設計
│   ├── ui-ux-improvement-plan.md       # UI/UX改善計画
│   ├── tide-system-master-spec.md      # 潮汐システム仕様
│   └── [機能別設計書]                  # 各機能の詳細設計
├── README.md                           # プロジェクト概要・使い方
├── docs/current-status-and-roadmap.md  # 現状とロードマップ
└── .claude/CLAUDE.md                   # 開発ガイドライン
```

---

## 設計書更新が必要なケース

以下のいずれかに該当する場合は、該当する設計書を必ず更新してください。

### アーキテクチャ・設計変更

- ✅ 新しいアーキテクチャパターンを導入
  - 例: 新しい状態管理パターン、新しいデザインパターン
  - 更新対象: `docs/design/architecture.md`

- ✅ 既存の設計方針を変更
  - 例: サービス層の役割変更、コンポーネント構成の変更
  - 更新対象: `docs/design/architecture.md`

- ✅ 新しいサービス層を追加
  - 例: `location-service.ts`, `notification-service.ts`
  - 更新対象: `docs/design/architecture.md`, `README.md`

### UI/UX変更

- ✅ UI/UX の構造を変更
  - 例: ナビゲーション構造の変更、画面フローの変更
  - 更新対象: `docs/design/ui-ux-improvement-plan.md`

### データモデル変更

- ✅ データモデルを変更
  - 例: IndexedDBスキーマ変更、型定義の大幅な変更
  - 更新対象: `docs/design/architecture.md`, 該当する機能別設計書

### 外部連携変更

- ✅ 外部API連携を追加・変更
  - 例: 新しい天気API、地図API、潮汐API
  - 更新対象: `docs/design/architecture.md`, 該当する機能別設計書

### パフォーマンス最適化

- ✅ パフォーマンス最適化の実装（記録として残す価値がある場合）
  - 例: レンダリング最適化の戦略、キャッシュ戦略
  - 更新対象: `docs/design/architecture.md`

### その他

- ✅ 新機能の追加（重要な機能）
  - 更新対象: `README.md`, `docs/current-status-and-roadmap.md`, 新規機能別設計書

- ✅ ロードマップの変更
  - 更新対象: `docs/current-status-and-roadmap.md`

---

## 設計書更新プロセス

### Step 1: 関連する設計書を特定

変更内容に応じて、更新すべき設計書を特定します。

| 変更種別 | 主要更新対象 | 補助更新対象 |
|---------|------------|------------|
| アーキテクチャ | `docs/design/architecture.md` | `README.md` |
| UI/UX | `docs/design/ui-ux-improvement-plan.md` | - |
| 新機能 | 新規機能別設計書 | `README.md`, `roadmap.md` |
| データモデル | `docs/design/architecture.md` | 機能別設計書 |
| 外部API | `docs/design/architecture.md` | 機能別設計書 |

### Step 2: 変更内容を明確に記述

設計書には以下の情報を含めてください：

#### 必須項目

- **変更内容**: 何を変更したか
- **変更理由**: なぜ変更したか（背景・目的）
- **変更日時**: いつ変更したか
- **影響範囲**: どのコンポーネント/機能に影響するか

#### 推奨項目

- **Before/After**: 変更前後の比較
- **トレードオフ**: 判断の根拠、選択しなかった代替案
- **参考資料**: 関連するIssue、PR、外部リンク

### Step 3: 影響範囲を記載

変更による影響範囲を明示します。

```markdown
## 影響範囲

### 影響を受けるコンポーネント
- `src/components/features/FishingRecord/`
- `src/lib/fishing-record-service.ts`

### 影響を受けるデータモデル
- `FishingRecord` インターフェース
- IndexedDB `fishing_records` テーブル

### 影響を受けるユーザーフロー
- 釣果記録の作成フロー
- 釣果記録の編集フロー

### 破壊的変更の有無
- ❌ なし / ✅ あり（移行手順を記載）
```

### Step 4: tech-lead エージェントにレビュー依頼

設計書更新後、必ず `tech-lead` エージェントにレビューを依頼してください。

```
"tech-lead エージェントに以下の設計書更新をレビューしてもらってください：

更新ファイル: docs/design/architecture.md
変更内容: [変更内容の概要]
変更理由: [変更理由]
影響範囲: [影響範囲]
"
```

---

## 設計書のテンプレート

### 機能別設計書テンプレート

新しい機能を追加する際は、以下のテンプレートを使用してください。

```markdown
# [機能名] 設計書

## 概要
[機能の概要を1-2段落で記述]

## 背景・目的
- なぜこの機能が必要か
- 解決したい課題

## ユーザーストーリー
As a [ユーザータイプ]
I want [機能]
So that [理由・価値]

## 受け入れ基準
- [ ] 基準1
- [ ] 基準2
- [ ] 基準3

## アーキテクチャ
### データモデル
```typescript
interface Example {
  // 型定義
}
```

### サービス層
- `example-service.ts`: 責務の説明

### コンポーネント構成
- `ExampleComponent.tsx`: 責務の説明

## UI/UXデザイン
[Figmaリンク、スクリーンショット、ワイヤーフレーム]

## 技術的な考慮事項
- パフォーマンス
- セキュリティ
- アクセシビリティ

## 影響範囲
[既存機能への影響]

## テスト戦略
- 単体テスト
- コンポーネントテスト
- E2Eテスト

## リリース計画
- [ ] フェーズ1: [内容]
- [ ] フェーズ2: [内容]

## 参考資料
- Issue: #123
- PR: #456
- 外部リンク: [URL]
```

---

## よくある質問

### Q1: 軽微なバグ修正でも設計書を更新すべきですか？

**A**: いいえ。軽微なバグ修正（1-2ファイルの小規模な修正）の場合は、PRの説明で十分です。
ただし、根本的な設計の問題を修正する場合は、設計書を更新してください。

### Q2: リファクタリングで設計書を更新すべきですか？

**A**: 構造が変わらないリファクタリング（コードの整理、命名変更など）は不要です。
アーキテクチャパターンやコンポーネント構成が変わる場合は更新してください。

### Q3: 設計書が古くなっている場合はどうすればいいですか？

**A**: `tech-lead` エージェントに相談して、更新計画を立ててください。
一度に全て更新するのではなく、変更を加える部分から順次更新することを推奨します。

### Q4: 設計書と実装が乖離している場合は？

**A**: 必ず設計書を優先してください。実装が正しい場合は設計書を更新し、
設計書が正しい場合は実装を修正してください。判断に迷う場合は `tech-lead` に相談してください。

---

**重要**: 設計書は「生きたドキュメント」です。コードと同様に、常に最新の状態を保つことで、
プロジェクトの保守性と開発効率が向上します。更新を怠らないようにしてください。
